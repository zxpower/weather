#!/bin/bash

: "${CITIES:=city: [Rīga, Salacgrīva]}"

# Parse cities from YAML and fetch weather for each
echo "$CITIES" | gomplate -i '{{ range $i, $city := (ds "cities").city }}{{ add 1 $i }}:
{{ $city }}
{{ end }}' -d "cities=stdin://?type=application/yaml" | \
while IFS= read -r line; do
  if [[ "$line" =~ ^[0-9]+: ]]; then
    # Print the number
    echo "$line"
  elif [ -n "$line" ]; then
    # Fetch and display weather for this city
    curl -s "https://wttr.in/$line?m&2"
  fi
done
